#!/bin/bash

# Taken from https://devcenter.heroku.com/articles/buildpack-api#bin-compile
export_env_dir() {
  env_dir=$1
  whitelist_regex=${2:-''}
  blacklist_regex=${3:-'^(PATH|GIT_DIR|CPATH|CPPATH|LD_PRELOAD|LIBRARY_PATH)$'}
  if [ -d "$env_dir" ]; then
    for f in "$env_dir"/*; do
      e=$(basename "$f")
      echo "$e" | grep -E "$whitelist_regex" | grep -qvE "$blacklist_regex" &&
      export "$e=$(cat "$env_dir/$e")" &&
      echo "$e variable exported"
      :
    done
  fi
}

ENV_DIR="$3"

export_env_dir "$ENV_DIR" '^PIP_.*'
